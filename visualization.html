<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accepted Papers Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .stat-card h3 { font-size: 2.5rem; color: #00d4ff; }
        .stat-card p { color: #aaa; margin-top: 5px; }
        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-box {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            max-height: 400px;
        }
        .chart-box h2 { margin-bottom: 15px; font-size: 1.2rem; color: #ddd; }
        .track-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 20px;
        }
        .track-item {
            padding: 10px 5px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
        }
        .track-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .track-item.has-papers {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: #fff;
        }
        .track-item.no-papers {
            background: linear-gradient(135deg, #d63031, #e17055);
            color: #fff;
        }
        .track-item .count { font-size: 1.1rem; font-weight: bold; }
        
        /* ModalÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close:hover { color: #00d4ff; }
        .modal h2 {
            color: #00d4ff;
            margin-bottom: 20px;
        }
        .modal-info {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .modal-info p {
            margin: 8px 0;
            color: #ddd;
        }
        .modal-info strong {
            color: #00d4ff;
        }
        .section-title { font-size: 1.5rem; margin: 30px 0 15px; color: #fff; }
        .legend { display: flex; gap: 20px; margin-bottom: 15px; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-color { width: 20px; height: 20px; border-radius: 4px; }
        .legend-color.green { background: linear-gradient(135deg, #00b894, #00cec9); }
        .legend-color.red { background: linear-gradient(135deg, #d63031, #e17055); }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            overflow: hidden;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        th { background: rgba(0,212,255,0.2); font-weight: 600; }
        tr:hover { background: rgba(255,255,255,0.05); }
        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Accepted Papers Track Distribution</h1>
        <div class="stats-grid">
            <div class="stat-card"><h3 id="totalPapers">-</h3><p>Total Accepted</p></div>
            <div class="stat-card"><h3 id="acceptanceRate">-</h3><p>Acceptance Rate</p></div>
            <div class="stat-card"><h3 id="totalTracks">-</h3><p>Tracks with Papers</p></div>
            <div class="stat-card"><h3 id="missingTracks">-</h3><p>Missing Tracks</p></div>
            <div class="stat-card"><h3 id="lectureCount">-</h3><p>Lectures</p></div>
            <div class="stat-card"><h3 id="posterCount">-</h3><p>Posters</p></div>
        </div>
        <div class="charts-container">
            <div class="chart-box"><h2>üìà Papers by Track (Top 20)</h2><canvas id="trackChart"></canvas></div>
        </div>
        <h2 class="section-title">üóÇÔ∏è All Tracks Status (ÁÇπÂáªÊü•ÁúãËØ¶ÊÉÖ)</h2>
        <div class="legend">
            <div class="legend-item"><div class="legend-color green"></div><span>Has Papers</span></div>
            <div class="legend-item"><div class="legend-color red"></div><span>No Papers (Missing)</span></div>
        </div>
        <div class="track-grid" id="trackGrid"></div>
        
        <h2 class="section-title">‚ùå Missing Tracks</h2>
        <div class="track-grid" id="missingGrid"></div>
        
        <!-- ModalÂºπÁ™ó -->
        <div id="trackModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2 id="modalTitle">Track Details</h2>
                <div class="modal-info" id="modalInfo"></div>
            </div>
        </div>
    </div>
    <script>
    // Ëá™ÂÆö‰πâÊéíÂ∫èÂáΩÊï∞ÔºöÊåâTrack IDÁöÑÊï∞Â≠óÈ°∫Â∫èÊéíÂ∫è
    function sortTrackIds(tracks) {
        return tracks.sort((a, b) => {
            const aParts = a.split('.').map(Number);
            const bParts = b.split('.').map(Number);
            
            // ÂÖàÊØîËæÉ‰∏ªTrackÂè∑
            if (aParts[0] !== bParts[0]) {
                return aParts[0] - bParts[0];
            }
            
            // Â¶ÇÊûú‰∏ªTrackÂè∑Áõ∏ÂêåÔºåÊØîËæÉÂ≠êTrackÂè∑
            const aSubTrack = aParts[1] || 0;
            const bSubTrack = bParts[1] || 0;
            return aSubTrack - bSubTrack;
        });
    }
    
    // Ê£ÄÊü•‰∏Ä‰∏™TrackÊòØÂê¶ÊúâÂ≠êTrack
    function hasSubTracks(trackId, allTrackIds) {
        const mainTrack = trackId.split('.')[0];
        // Â¶ÇÊûútrackIdÊú¨Ë∫´Â∞±ÊòØÂ≠êTrackÔºàÂåÖÂê´.ÔºâÔºåÂàô‰∏çÊòØÊØçTrack
        if (trackId.includes('.')) return false;
        // Ê£ÄÊü•ÊòØÂê¶Â≠òÂú®‰ª•ËØ•TrackÂè∑ÂºÄÂ§¥ÁöÑÂ≠êTrack
        return allTrackIds.some(id => id.startsWith(mainTrack + '.'));
    }
    
    // Âπ∂Ë°åÂä†ËΩΩÊï∞ÊçÆÂíåTrackÂàóË°®
    Promise.all([
        fetch('accepted_papers.json').then(r => r.json()),
        fetch('tracks.json').then(r => r.json())
    ]).then(([data, tracksData]) => {
        // ‰ªétracks.jsonËé∑ÂèñÊâÄÊúâTrack ID
        const allTrackIds = Object.keys(tracksData);
        
        // ËøáÊª§ËßÑÂàôÔºö
        // 1. ÊéíÈô§CANCELLEDÁöÑTrack
        // 2. ÊéíÈô§ÊúâÂ≠êTrackÁöÑÊØçTrackÔºàÂõ†‰∏∫ÊØçTrack‰∏çËÉΩÊäïÈÄíÔºâ
        const allExpectedTracks = sortTrackIds(
            allTrackIds.filter(id => {
                // ÊéíÈô§CANCELLED
                if (tracksData[id].includes('CANCELLED')) return false;
                // ÊéíÈô§ÊúâÂ≠êTrackÁöÑÊØçTrack
                if (hasSubTracks(id, allTrackIds)) return false;
                return true;
            })
        );
        const trackStats = {};
        let lectureCount = 0, posterCount = 0;
        let minPaperId = Infinity, maxPaperId = -Infinity;
        
        data.forEach(p => {
            const t = p.track_id;
            if (!trackStats[t]) trackStats[t] = { total: 0, lecture: 0, poster: 0 };
            trackStats[t].total++;
            if (p.final_decision.includes('Lecture')) { trackStats[t].lecture++; lectureCount++; }
            else if (p.final_decision.includes('Poster')) { trackStats[t].poster++; posterCount++; }
            
            // ËÆ°ÁÆópaper_idËåÉÂõ¥
            if (p.paper_id < minPaperId) minPaperId = p.paper_id;
            if (p.paper_id > maxPaperId) maxPaperId = p.paper_id;
        });
        
        // ËÆ°ÁÆó‰∏≠Á®øÁéá
        const totalSubmissions = maxPaperId - minPaperId + 1;
        const acceptanceRate = ((data.length / totalSubmissions) * 100).toFixed(1);
        
        const existingTracks = Object.keys(trackStats);
        const missingTracks = allExpectedTracks.filter(t => !existingTracks.includes(t));
        
        document.getElementById('totalPapers').textContent = data.length;
        document.getElementById('acceptanceRate').textContent = acceptanceRate + '%';
        document.getElementById('acceptanceRate').title = `${data.length} accepted / ${totalSubmissions} submissions (Paper ID: ${minPaperId}-${maxPaperId})`;
        document.getElementById('totalTracks').textContent = existingTracks.length;
        document.getElementById('missingTracks').textContent = missingTracks.length;
        document.getElementById('lectureCount').textContent = lectureCount;
        document.getElementById('posterCount').textContent = posterCount;
        // ModalÁõ∏ÂÖ≥
        const modal = document.getElementById('trackModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalInfo = document.getElementById('modalInfo');
        const closeBtn = document.querySelector('.close');
        
        closeBtn.onclick = () => modal.style.display = 'none';
        window.onclick = (e) => { if (e.target == modal) modal.style.display = 'none'; };
        
        function showTrackDetails(trackId) {
            const stats = trackStats[trackId];
            const trackName = tracksData[trackId] || 'Unknown Track';
            
            modalTitle.textContent = `Track ${trackId}`;
            
            if (stats) {
                modalInfo.innerHTML = `
                    <p><strong>Track Name:</strong> ${trackName}</p>
                    <p><strong>Total Papers:</strong> ${stats.total}</p>
                    <p><strong>Lectures:</strong> ${stats.lecture}</p>
                    <p><strong>Posters:</strong> ${stats.poster}</p>
                `;
            } else {
                modalInfo.innerHTML = `
                    <p><strong>Track Name:</strong> ${trackName}</p>
                    <p style="color:#e17055;"><strong>Status:</strong> ‚ö†Ô∏è No papers accepted yet</p>
                `;
            }
            
            modal.style.display = 'block';
        }
        
        // Ê∏≤ÊüìAll Tracks Status
        const trackGrid = document.getElementById('trackGrid');
        allExpectedTracks.forEach(track => {
            const div = document.createElement('div');
            const has = trackStats[track];
            div.className = `track-item ${has ? 'has-papers' : 'no-papers'}`;
            div.innerHTML = `<div>${track}</div><div class="count">${has ? trackStats[track].total : '‚úó'}</div>`;
            div.onclick = () => showTrackDetails(track);
            trackGrid.appendChild(div);
        });
        
        // Ê∏≤ÊüìMissing TracksÁΩëÊ†º
        const missingGrid = document.getElementById('missingGrid');
        if (missingTracks.length === 0) {
            missingGrid.innerHTML = '<p style="color:#00b894;text-align:center;padding:20px;">üéâ All tracks have papers!</p>';
        } else {
            missingTracks.forEach(track => {
                const div = document.createElement('div');
                div.className = 'track-item no-papers';
                div.innerHTML = `<div>${track}</div><div class="count">‚úó</div>`;
                div.onclick = () => showTrackDetails(track);
                missingGrid.appendChild(div);
            });
        }
        
        // ÂáÜÂ§áÂõæË°®Êï∞ÊçÆ
        const sorted = Object.entries(trackStats).sort((a, b) => b[1].total - a[1].total);
        const top20 = sorted.slice(0, 20);
        
        // Bar Chart - Papers by Track
        new Chart(document.getElementById('trackChart'), {
            type: 'bar',
            data: {
                labels: top20.map(t => t[0]),
                datasets: [{
                    label: 'Papers',
                    data: top20.map(t => t[1].total),
                    backgroundColor: 'rgba(0,212,255,0.7)',
                    borderColor: 'rgba(0,212,255,1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: '#aaa', font: { size: 11 } },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    x: {
                        ticks: { color: '#aaa', font: { size: 11 } },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                }
            }
        });
    }).catch(e => { console.error(e); document.body.innerHTML = '<h1 style="color:red;text-align:center;margin-top:50px">Error loading data</h1>'; });
    </script>
</body>
</html>